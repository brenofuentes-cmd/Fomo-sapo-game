<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>FOMO SAPO ‚Äî Hop to the Moon</title>
  <style>
    :root{
      --bg0:#070816;
      --bg1:#120026;
      --neonG:#39FF14;
      --neonG2:#00FF88;
      --neonC:#00E5FF;
      --neonP:#B100FF;
      --gold:#FFD700;
      --text:#EAF7FF;
      --glass: rgba(255,255,255,.08);
      --glass2: rgba(255,255,255,.12);
    }
    html,body{height:100%; margin:0; background: radial-gradient(1200px 700px at 50% 20%, #1b0a3a 0%, var(--bg0) 55%, #04040b 100%); color:var(--text); font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;}
    #wrap{position:fixed; inset:0; display:grid; place-items:center;}
    canvas{width:min(92vw, 520px); height:min(86vh, 920px); border-radius:24px; background: linear-gradient(180deg, rgba(8,10,24,.35), rgba(4,4,11,.35)); box-shadow:
      0 0 0 1px rgba(255,255,255,.08),
      0 0 35px rgba(0,255,136,.20),
      0 0 70px rgba(177,0,255,.10);
      touch-action: manipulation;
    }
    .hud{
      position:absolute; top:18px; width:min(92vw, 520px);
      display:flex; justify-content:space-between; gap:12px;
      pointer-events:none; padding:0 18px;
      filter: drop-shadow(0 0 10px rgba(0,255,136,.25));
    }
    .pill{
      pointer-events:none;
      background: linear-gradient(135deg, rgba(57,255,20,.12), rgba(0,229,255,.10));
      border:1px solid rgba(255,255,255,.12);
      border-radius:999px; padding:8px 12px; backdrop-filter: blur(10px);
      font-weight:700; letter-spacing:.5px; font-size:12px;
    }
    .kbd{
      pointer-events:none;
      opacity:.85; font-weight:600;
    }
    .overlay{
      position:absolute; inset:0; display:grid; place-items:center;
      width:min(92vw, 520px); height:min(86vh, 920px);
      border-radius:24px;
      pointer-events:none;
    }
    .card{
      pointer-events:auto;
      width:min(88%, 420px);
      background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.06));
      border:1px solid rgba(255,255,255,.14);
      border-radius:22px;
      padding:18px 18px 16px;
      backdrop-filter: blur(14px);
      box-shadow: 0 0 30px rgba(0,255,136,.18);
    }
    .title{
      display:flex; align-items:center; gap:10px;
      font-weight:900; font-size:18px; letter-spacing:1px;
      text-transform:uppercase;
    }
    .tag{
      margin-top:8px;
      font-size:12px; opacity:.9;
    }
    .tag strong{color:var(--neonG); text-shadow: 0 0 14px rgba(57,255,20,.45);}
    .btnRow{display:flex; gap:10px; margin-top:14px;}
    button{
      all:unset; cursor:pointer; flex:1;
      text-align:center;
      padding:12px 12px;
      border-radius:14px;
      font-weight:900; letter-spacing:1px; text-transform:uppercase;
      border:1px solid rgba(255,255,255,.14);
      background: linear-gradient(135deg, rgba(57,255,20,.20), rgba(0,229,255,.14));
      box-shadow: 0 0 20px rgba(0,255,136,.20);
      user-select:none;
    }
    button.secondary{
      background: linear-gradient(135deg, rgba(177,0,255,.18), rgba(57,255,20,.10));
      box-shadow: 0 0 18px rgba(177,0,255,.14);
    }
    button:active{transform: translateY(1px);}
    .small{
      margin-top:10px; font-size:11px; opacity:.85; line-height:1.35;
    }
    .small code{background: rgba(0,0,0,.25); padding:2px 6px; border-radius:999px; border:1px solid rgba(255,255,255,.10);}
    .hide{display:none;}
  </style>
</head>
<body>
<div id="wrap">
  <canvas id="c" aria-label="FOMO SAPO Game"></canvas>

  <div class="hud">
    <div class="pill">SCORE: <span id="score">0</span></div>
    <div class="pill">BEST: <span id="best">0</span></div>
  </div>

  <div class="overlay" id="startOverlay">
    <div class="card">
      <div class="title">
        <span style="filter:drop-shadow(0 0 12px rgba(57,255,20,.55));">üê∏</span>
        FOMO SAPO ‚Äî HOP TO THE MOON
      </div>
      <div class="tag"><strong>Stop chasing.</strong> Start hopping.</div>
      <div class="btnRow">
        <button id="playBtn">Play</button>
        <button class="secondary" id="muteBtn">Sound: On</button>
      </div>
      <div class="small">
        Controles: <code>clique/toque</code> ou <code>espa√ßo</code> para saltar. Passe pelos portais neon.
        <br/>Dica: toque curto = melhor controle.
      </div>
    </div>
  </div>

  <div class="overlay hide" id="overOverlay">
    <div class="card">
      <div class="title">REKT. TRY AGAIN, ANON.</div>
      <div class="tag">Score: <strong><span id="finalScore">0</span></strong> ‚Ä¢ Best: <strong><span id="finalBest">0</span></strong></div>
      <div class="btnRow">
        <button id="againBtn">Play Again</button>
        <button class="secondary" id="shareBtn">Share</button>
      </div>
      <div class="small">
        Compartilhar copia uma frase para colar no X/TikTok/Telegram.
      </div>
    </div>
  </div>
</div>

<script>
(() => {
  const canvas = document.getElementById('c');
  const ctx = canvas.getContext('2d');

  const scoreEl = document.getElementById('score');
  const bestEl  = document.getElementById('best');

  const startOverlay = document.getElementById('startOverlay');
  const overOverlay  = document.getElementById('overOverlay');
  const playBtn = document.getElementById('playBtn');
  const againBtn = document.getElementById('againBtn');
  const muteBtn = document.getElementById('muteBtn');
  const shareBtn = document.getElementById('shareBtn');
  const finalScoreEl = document.getElementById('finalScore');
  const finalBestEl  = document.getElementById('finalBest');

  // --- Responsive canvas (DPR) ---
  function resize() {
    const cssW = Math.min(window.innerWidth * 0.92, 520);
    const cssH = Math.min(window.innerHeight * 0.86, 920);
    canvas.style.width  = cssW + 'px';
    canvas.style.height = cssH + 'px';

    const dpr = Math.max(1, Math.min(window.devicePixelRatio || 1, 2));
    canvas.width  = Math.floor(cssW * dpr);
    canvas.height = Math.floor(cssH * dpr);
    ctx.setTransform(dpr,0,0,dpr,0,0);
  }
  window.addEventListener('resize', resize, {passive:true});
  resize();

  // --- Local storage best ---
  const BEST_KEY = 'fomosapo_best_v1';
  let best = Number(localStorage.getItem(BEST_KEY) || 0);
  bestEl.textContent = String(best);

  // --- Audio (tiny synth beeps) ---
  let soundOn = true;
  const AudioCtx = window.AudioContext || window.webkitAudioContext;
  let actx = null;
  function beep(freq=440, dur=0.06, type='sine', gain=0.06) {
    if (!soundOn) return;
    try{
      if (!actx) actx = new AudioCtx();
      const o = actx.createOscillator();
      const g = actx.createGain();
      o.type = type;
      o.frequency.value = freq;
      g.gain.value = gain;
      o.connect(g); g.connect(actx.destination);
      o.start();
      o.stop(actx.currentTime + dur);
    } catch(e){}
  }
  function thud() { beep(120, 0.12, 'triangle', 0.09); }
  function coin() { beep(880, 0.05, 'square', 0.05); beep(1320, 0.04, 'square', 0.03); }
  function hop()  { beep(520, 0.05, 'sine', 0.06); }

  muteBtn.addEventListener('click', () => {
    soundOn = !soundOn;
    muteBtn.textContent = 'Sound: ' + (soundOn ? 'On' : 'Off');
    if (soundOn) beep(660, 0.05, 'sine', 0.05);
  });

  // --- Game constants (neon vibe) ---
  const COLORS = {
    bgTop: '#120026',
    bgBot: '#070816',
    moon: '#6BFF9A',
    neonG: '#39FF14',
    neonG2:'#00FF88',
    neonC: '#00E5FF',
    neonP: '#B100FF',
    gold:  '#FFD700',
    text:  '#EAF7FF'
  };

  // World in "CSS pixels" coords (because we set transform for DPR already)
  function W(){ return canvas.clientWidth  || parseFloat(canvas.style.width); }
  function H(){ return canvas.clientHeight || parseFloat(canvas.style.height); }

  // Entities
  let state = 'start'; // start | play | over
  let tPrev = 0;

  const frog = {
    x: 0, y: 0, vy: 0,
    r: 18,
    rot: 0
  };

  let score = 0;

  const world = {
    gravity: 1400,
    jumpV: -420,
    speed: 190,
    gap: 140,
    pipeW: 66,
    spawnEvery: 1.25, // seconds
    spawnTimer: 0,
  };

  const pipes = [];
  const fireflies = [];
  const stars = [];
  const ripples = [];

  function rand(a,b){ return a + Math.random()*(b-a); }
  function clamp(v,a,b){ return Math.max(a, Math.min(b,v)); }

  function resetGame() {
    score = 0;
    scoreEl.textContent = '0';
    world.speed = 190;
    world.gap = clamp(H()*0.22, 120, 170);
    world.spawnTimer = 0;
    pipes.length = 0;

    frog.x = W()*0.30;
    frog.y = H()*0.52;
    frog.vy = 0;
    frog.rot = 0;

    // Background actors
    stars.length = 0;
    fireflies.length = 0;
    ripples.length = 0;

    const nStars = Math.floor(clamp(W()*H()/16000, 40, 110));
    for (let i=0;i<nStars;i++){
      stars.push({x: Math.random()*W(), y: Math.random()*H()*0.7, r: rand(0.8, 2.1), a: rand(0.25, 0.9), tw: rand(0.8, 2.2)});
    }
    const nFlies = Math.floor(clamp(W()*H()/22000, 14, 35));
    for (let i=0;i<nFlies;i++){
      fireflies.push({x: Math.random()*W(), y: rand(H()*0.20, H()*0.92), r: rand(2.0, 4.5), vx: rand(-12, 12), vy: rand(-10, 10), phase: rand(0,Math.PI*2)});
    }
  }

  // Pipes: each has x, topH, passed flag
  function spawnPipe(){
    const margin = 90;
    const topH = rand(margin, H() - margin - world.gap);
    pipes.push({
      x: W() + 20,
      topH,
      passed:false
    });
  }

  // --- Input ---
  function doJump(){
    if (state === 'start') {
      startOverlay.classList.add('hide');
      state = 'play';
      resetGame();
      // immediate hop
      frog.vy = world.jumpV;
      hop();
      return;
    }
    if (state === 'over') {
      overOverlay.classList.add('hide');
      state = 'play';
      resetGame();
      frog.vy = world.jumpV;
      hop();
      return;
    }
    if (state !== 'play') return;
    frog.vy = world.jumpV;
    hop();
    // add tiny ripple for vibe
    ripples.push({x:frog.x, y:frog.y+frog.r+10, t:0});
  }

  window.addEventListener('keydown', (e)=>{
    if (e.code === 'Space' || e.code === 'ArrowUp') {
      e.preventDefault();
      doJump();
    }
  }, {passive:false});

  canvas.addEventListener('pointerdown', (e)=>{
    e.preventDefault();
    doJump();
  });

  playBtn.addEventListener('click', doJump);
  againBtn.addEventListener('click', doJump);

  shareBtn.addEventListener('click', async ()=>{
    const text = `I scored $${score} in FOMO SAPO ‚Äî Hop to the Moon. Stop chasing. Start hopping. üê∏üöÄ`;
    try{
      await navigator.clipboard.writeText(text);
      shareBtn.textContent = 'Copied!';
      setTimeout(()=>shareBtn.textContent='Share', 900);
    } catch(e){
      // fallback
      prompt('Copie e cole:', text);
    }
  });

  // --- Collision helpers ---
  function circleRectColl(cx,cy,cr, rx,ry,rw,rh){
    const nx = clamp(cx, rx, rx+rw);
    const ny = clamp(cy, ry, ry+rh);
    const dx = cx - nx, dy = cy - ny;
    return (dx*dx + dy*dy) <= cr*cr;
  }

  // --- Render: neon cyber swamp moon vibe ---
  function drawBackground(time){
    const w = W(), h = H();

    // Gradient sky
    const g = ctx.createLinearGradient(0,0,0,h);
    g.addColorStop(0, COLORS.bgTop);
    g.addColorStop(1, COLORS.bgBot);
    ctx.fillStyle = g;
    ctx.fillRect(0,0,w,h);

    // Stars (twinkle)
    for (const s of stars){
      const tw = 0.5 + 0.5*Math.sin(time*s.tw + s.x*0.01);
      ctx.globalAlpha = s.a * (0.55 + 0.45*tw);
      ctx.fillStyle = '#EAF7FF';
      ctx.beginPath();
      ctx.arc(s.x, s.y, s.r, 0, Math.PI*2);
      ctx.fill();
    }
    ctx.globalAlpha = 1;

    // Big green moon (glow)
    const mx = w*0.55, my = h*0.20;
    const mr = Math.min(w,h)*0.22;

    ctx.save();
    ctx.globalAlpha = 0.92;
    ctx.shadowColor = 'rgba(0,255,136,.65)';
    ctx.shadowBlur = 40;
    ctx.fillStyle = COLORS.moon;
    ctx.beginPath();
    ctx.arc(mx,my,mr,0,Math.PI*2);
    ctx.fill();

    // Moon texture (subtle craters)
    ctx.shadowBlur = 0;
    ctx.globalAlpha = 0.15;
    ctx.fillStyle = '#0b1026';
    for (let i=0;i<10;i++){
      const r = rand(mr*0.04, mr*0.14);
      ctx.beginPath();
      ctx.arc(mx+rand(-mr*0.45,mr*0.45), my+rand(-mr*0.35,mr*0.35), r, 0, Math.PI*2);
      ctx.fill();
    }
    ctx.restore();

    // Neon mist band
    ctx.save();
    ctx.globalAlpha = 0.16;
    ctx.fillStyle = 'rgba(177,0,255,.55)';
    ctx.fillRect(0, h*0.42, w, h*0.16);
    ctx.globalAlpha = 0.12;
    ctx.fillStyle = 'rgba(0,229,255,.55)';
    ctx.fillRect(0, h*0.50, w, h*0.18);
    ctx.restore();

    // Water/swamp at bottom
    ctx.save();
    ctx.globalAlpha = 0.22;
    const wg = ctx.createLinearGradient(0,h*0.62,0,h);
    wg.addColorStop(0,'rgba(0,255,136,.00)');
    wg.addColorStop(1,'rgba(0,255,136,.25)');
    ctx.fillStyle = wg;
    ctx.fillRect(0,h*0.62,w,h*0.38);
    ctx.restore();

    // Fireflies
    for (const f of fireflies){
      const glow = 0.5 + 0.5*Math.sin(time*2.2 + f.phase);
      ctx.save();
      ctx.globalAlpha = 0.25 + 0.55*glow;
      ctx.shadowColor = 'rgba(57,255,20,.9)';
      ctx.shadowBlur = 18;
      ctx.fillStyle = COLORS.neonG2;
      ctx.beginPath();
      ctx.arc(f.x, f.y, f.r*(0.75+0.4*glow), 0, Math.PI*2);
      ctx.fill();
      ctx.restore();
    }

    // Ripples
    for (const r of ripples){
      const a = Math.max(0, 0.35 - r.t*0.5);
      if (a <= 0) continue;
      ctx.save();
      ctx.globalAlpha = a;
      ctx.strokeStyle = 'rgba(0,255,136,.7)';
      ctx.lineWidth = 2;
      ctx.shadowColor = 'rgba(0,255,136,.6)';
      ctx.shadowBlur = 14;
      ctx.beginPath();
      ctx.ellipse(r.x, r.y, 10 + r.t*40, 4 + r.t*18, 0, 0, Math.PI*2);
      ctx.stroke();
      ctx.restore();
    }
  }

  function drawNeonPipe(x, topH){
    const w = W(), h = H();
    const pw = world.pipeW;
    const gap = world.gap;
    const botY = topH + gap;
    const botH = h - botY;

    // Style
    const drawPortal = (rx, ry, rw, rh, accent) => {
      ctx.save();
      // body
      const grad = ctx.createLinearGradient(rx, ry, rx+rw, ry+rh);
      grad.addColorStop(0, 'rgba(25, 20, 60, .95)');
      grad.addColorStop(1, 'rgba(10, 10, 25, .95)');
      ctx.fillStyle = grad;
      ctx.fillRect(rx, ry, rw, rh);

      // inner glow border
      ctx.strokeStyle = accent;
      ctx.lineWidth = 3;
      ctx.shadowColor = accent;
      ctx.shadowBlur = 18;
      ctx.strokeRect(rx+1.5, ry+1.5, rw-3, rh-3);

      // neon bands
      ctx.shadowBlur = 0;
      ctx.globalAlpha = 0.6;
      ctx.fillStyle = accent;
      ctx.fillRect(rx, ry + rh*0.12, rw, 4);
      ctx.fillRect(rx, ry + rh*0.88, rw, 4);

      // subtle scanline
      ctx.globalAlpha = 0.12;
      ctx.fillStyle = '#EAF7FF';
      for (let i=0;i<rh;i+=18) ctx.fillRect(rx, ry+i, rw, 1);

      ctx.restore();
    };

    // Top portal
    drawPortal(x, 0, pw, topH, 'rgba(177,0,255,.85)');
    // Bottom portal
    drawPortal(x, botY, pw, botH, 'rgba(0,229,255,.80)');

    // Hint lights near gap edges
    ctx.save();
    ctx.shadowColor = 'rgba(0,255,136,.8)';
    ctx.shadowBlur = 18;
    ctx.fillStyle = 'rgba(57,255,20,.9)';
    ctx.globalAlpha = 0.9;
    ctx.fillRect(x-2, topH-6, pw+4, 6);
    ctx.fillRect(x-2, botY, pw+4, 6);
    ctx.restore();
  }

  function drawFrog(){
    // Procedural neon 2D frog with sunglasses + coin chain vibe
    const x = frog.x, y = frog.y;
    const r = frog.r;

    ctx.save();
    ctx.translate(x,y);
    ctx.rotate(frog.rot);

    // Glow
    ctx.shadowColor = 'rgba(0,255,136,.75)';
    ctx.shadowBlur = 22;

    // Body gradient
    const bodyG = ctx.createRadialGradient(-r*0.3,-r*0.4, r*0.2, 0,0, r*1.4);
    bodyG.addColorStop(0, '#B9FFB0');
    bodyG.addColorStop(0.45, '#39FF14');
    bodyG.addColorStop(1, '#0A7F3C');
    ctx.fillStyle = bodyG;

    // Body
    ctx.beginPath();
    ctx.ellipse(0,0, r*1.15, r, 0, 0, Math.PI*2);
    ctx.fill();

    // Belly highlight
    ctx.shadowBlur = 0;
    ctx.globalAlpha = 0.25;
    ctx.fillStyle = '#EAF7FF';
    ctx.beginPath();
    ctx.ellipse(-r*0.2, r*0.15, r*0.55, r*0.45, 0.2, 0, Math.PI*2);
    ctx.fill();
    ctx.globalAlpha = 1;

    // Eyes
    const eye = (ex) => {
      ctx.save();
      ctx.translate(ex, -r*0.55);
      ctx.shadowColor = 'rgba(0,229,255,.55)';
      ctx.shadowBlur = 14;
      ctx.fillStyle = '#B9FFB0';
      ctx.beginPath();
      ctx.arc(0,0, r*0.42, 0, Math.PI*2);
      ctx.fill();

      ctx.shadowBlur = 0;
      ctx.fillStyle = '#071023';
      ctx.beginPath();
      ctx.arc(r*0.07, r*0.06, r*0.20, 0, Math.PI*2);
      ctx.fill();

      ctx.fillStyle = '#EAF7FF';
      ctx.beginPath();
      ctx.arc(r*0.12, -r*0.02, r*0.07, 0, Math.PI*2);
      ctx.fill();
      ctx.restore();
    };
    eye(-r*0.55);
    eye(r*0.55);

    // Sunglasses (with tiny chart reflection)
    ctx.save();
    ctx.translate(0, -r*0.55);
    ctx.shadowColor = 'rgba(255,215,0,.55)';
    ctx.shadowBlur = 14;

    ctx.strokeStyle = 'rgba(255,215,0,.85)';
    ctx.lineWidth = 2.5;

    const lens = (lx) => {
      ctx.save();
      ctx.translate(lx, 0);
      ctx.fillStyle = 'rgba(6,6,12,.75)';
      ctx.beginPath();
      ctx.roundRect(-r*0.42, -r*0.22, r*0.84, r*0.44, 8);
      ctx.fill();
      ctx.stroke();

      // chart reflection
      ctx.clip();
      ctx.globalAlpha = 0.9;
      ctx.strokeStyle = 'rgba(0,255,136,.9)';
      ctx.lineWidth = 2;
      ctx.beginPath();
      ctx.moveTo(-r*0.32, r*0.12);
      ctx.lineTo(-r*0.14, r*0.02);
      ctx.lineTo(0, r*0.06);
      ctx.lineTo(r*0.14, -r*0.04);
      ctx.lineTo(r*0.30, -r*0.12);
      ctx.stroke();

      ctx.globalAlpha = 1;
      ctx.restore();
    };
    lens(-r*0.55);
    lens(r*0.55);

    // bridge
    ctx.shadowBlur = 0;
    ctx.strokeStyle = 'rgba(255,215,0,.85)';
    ctx.lineWidth = 2.2;
    ctx.beginPath();
    ctx.moveTo(-r*0.15, 0);
    ctx.lineTo(r*0.15, 0);
    ctx.stroke();

    ctx.restore();

    // Coin chain (simple medallion)
    ctx.save();
    ctx.translate(0, r*0.55);
    ctx.shadowColor = 'rgba(255,215,0,.55)';
    ctx.shadowBlur = 16;
    ctx.fillStyle = 'rgba(255,215,0,.92)';
    ctx.beginPath();
    ctx.arc(0,0, r*0.33, 0, Math.PI*2);
    ctx.fill();

    ctx.shadowBlur = 0;
    ctx.fillStyle = 'rgba(10,10,25,.45)';
    ctx.font = `900 $${Math.floor(r*0.32)}px ui-sans-serif`;
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.fillText('$$', 0, 1);
    ctx.restore();

    ctx.restore();
  }

  // Polyfill roundRect for older browsers
  if (!CanvasRenderingContext2D.prototype.roundRect) {
    CanvasRenderingContext2D.prototype.roundRect = function(x,y,w,h,r){
      const rr = Math.min(r, w/2, h/2);
      this.beginPath();
      this.moveTo(x+rr, y);
      this.arcTo(x+w, y, x+w, y+h, rr);
      this.arcTo(x+w, y+h, x, y+h, rr);
      this.arcTo(x, y+h, x, y, rr);
      this.arcTo(x, y, x+w, y, rr);
      this.closePath();
      return this;
    };
  }

  function drawHUDHint(){
    if (state !== 'play' && state !== 'start') return;
    if (score > 0) return;
    // tiny hint at bottom
    ctx.save();
    ctx.globalAlpha = 0.85;
    ctx.font = '700 12px ui-sans-serif';
    ctx.textAlign='center';
    ctx.textBaseline='middle';
    ctx.fillStyle = 'rgba(234,247,255,.9)';
    ctx.shadowColor = 'rgba(0,255,136,.35)';
    ctx.shadowBlur = 18;
    ctx.fillText('TOQUE / CLIQUE / ESPA√áO PARA SALTAR', W()*0.5, H()*0.92);
    ctx.restore();
  }

  // --- Update loop ---
  function update(dt, time){
    const w = W(), h = H();

    // Background motion (fireflies drift)
    for (const f of fireflies){
      f.x += f.vx * dt;
      f.y += f.vy * dt;
      f.phase += dt*0.8;

      // gentle wander
      f.vx += Math.sin(time*0.7 + f.phase) * dt * 4;
      f.vy += Math.cos(time*0.9 + f.phase) * dt * 3;

      // clamp velocity
      f.vx = clamp(f.vx, -18, 18);
      f.vy = clamp(f.vy, -14, 14);

      if (f.x < -20) f.x = w+20;
      if (f.x > w+20) f.x = -20;
      f.y = clamp(f.y, h*0.18, h*0.96);
    }

    // ripples
    for (const r of ripples) r.t += dt;
    while (ripples.length && ripples[
